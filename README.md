# Trenatest

## پلتفرم معاملاتی: راهنمای فرانت‌اند تمیز و مقیاس‌پذیر

> وضعیت: **فاز 2 – وایرفریم Hi-Fi و کیت کامپوننت**. خروجی‌های فاز 1 قفل شده و مشخصات وایرفریم/کیت در دسترس هستند تا ورود به فاز 3 بدون ابهام انجام شود.

### معماری پیشنهادی
- **کامپوننت‌محور با امکان گسترش به میکروفرانت‌اند**: ساختار ماژولار با تفکیک مسئولیت‌ها (UI، منطق، داده) و قابلیت توسعه مستقل هر دامنه. در صورت رشد تیم (۵ تیم یا بیشتر) یا ماژول‌های مجزا، امکان مهاجرت تدریجی به میکروفرانت‌اند فراهم است.
- **Atomic Design و تفکیک کامپوننت‌ها**: اتم → مولکول → ارگانیسم → قالب → صفحه؛ کامپوننت‌های نمایشی در برابر کانتینرها برای جداسازی منطق و UI.
- **ساختار پوشه پیاده‌سازی‌شده در `src/`**: زیرپوشه‌های `assets`, `components/{common,trading}`, `pages`, `hooks`, `services`, `utils`, `theme` ایجاد شده‌اند و برای هرکدام README راهنما وجود دارد. جزئیات معماری و جریان داده در `ARCHITECTURE.md` آمده است.

### تکنولوژی‌ها و فریمورک‌ها
- **React + TypeScript** برای ترکیب کامپوننت‌محوری و ایمنی نوع.
- **Tailwind CSS** برای استایل سریع، بهینه و یکدست؛ در صورت نیاز CSS Modules یا CSS-in-JS برای بخش‌های خاص.
- **ارتباط بلادرنگ**: WebSocket (wss://) برای فید قیمت و عمق بازار؛ SSE یا پولینگ به‌عنوان پشتیبان.
- **کتابخانه‌های مکمل**: React Query برای مدیریت state سروری و کش، React Hook Form/Formik برای فرم‌ها، کتابخانه چارت مانند Lightweight Charts/Highcharts/Visx بر حسب نیاز عملکرد.

### بهینه‌سازی عملکرد
- **کد اسپلینتینگ و Lazy Loading** در سطح صفحه و کامپوننت.
- **Memoization و Virtualization** (React.memo، useMemo/useCallback، react-window/react-virtualized) برای لیست‌ها و جدول‌های حجیم.
- **Web Workers یا سطح‌بندی اجزای سنگین** برای پردازش‌های پرهزینه نمودار/محاسبات.
- **Throttling/Debouncing** برای فیدهای پرسرعت و ورودی کاربر.
- **کش سمت کلاینت** با React Query (الگوی Stale-While-Revalidate) و استفاده از CDN/HTTP Cache برای منابع استاتیک.
- **پروفایلینگ مستمر** با React Profiler و ابزار Performance مرورگر + مانیتورینگ خطا/عملکرد (Sentry/LogRocket).

### مدیریت State
- **State محلی** با useState/useReducer برای منطق محدود.
- **Context API** برای داده‌های کم‌تغییر و دامنه‌بندی‌شده (مثلاً تم یا کاربر فعال) با دقت در کاهش رندر اضافی.
- **React Query** منبع حقیقت داده‌های سروری (فچ، کش، همگام‌سازی مجدد).
- **Zustand یا Redux Toolkit** برای state گلوبال کلاینتی؛ Zustand برای سادگی و حجم کم، Redux Toolkit برای ساختاردهی بیشتر در دامنه‌های پیچیده.

### امنیت سمت کلاینت
- **پیشگیری از XSS**: اعتبارسنجی/سانیتایز ورودی، اجتناب از `dangerouslySetInnerHTML`، استفاده از CSP محدودکننده منابع اسکریپت.
- **محافظت در برابر CSRF**: توکن CSRF یا SameSite Cookie برای درخواست‌های حساس؛ ارسال روی HTTPS/WSS.
- **ذخیره‌سازی امن**: پرهیز از نگهداری توکن در LocalStorage؛ استفاده از HttpOnly/Secure Cookies یا رمزنگاری سمت کلاینت در صورت ضرورت.
- **هدرهای امنیتی**: HSTS، X-Content-Type-Options، Referrer-Policy، X-Frame-Options / `frame-ancestors 'none'` برای ضد کلیک‌جکینگ.
- **وابستگی‌های امن**: به‌روزرسانی منظم، `npm audit`، اجتناب از پکیج‌های غیرضروری.
- **اصل اعتماد نکردن به کلاینت**: تمام اعتبارسنجی‌های حیاتی باید سمت سرور تکرار شوند.

### الگوهای UX و طراحی بصری
- **سادگی و Progressive Disclosure**: قابلیت‌های پرکاربرد در دسترس فوری؛ حالت Lite/Pro برای تفکیک سطوح کاربری.
- **دارک/لایت مود و پالت محدود**: پس‌زمینه‌های تیره/خنثی، رنگ تأکیدی برند، وضعیت‌ها با کنتراست کافی و توجه به کوررنگی.
- **گرادینت و گلس‌مورفیسم کنترل‌شده**: استفاده ملایم برای هدر یا کارت‌های شناور؛ پرهیز از کاهش خوانایی.
- **تایپوگرافی خوانا**: فونت فارسی مناسب و فونت با ارقام tabular برای جداول مالی؛ وزن و اندازه‌گذاری بر اساس سلسله‌مراتب اطلاعات.
- **Micro-interactions و بازخورد فوری**: انیمیشن‌های سبک (Framer Motion/CSS)، نوتیفیکیشن‌های شفاف، نشانگر بارگذاری برای عملیات حساس.

### ریسپانسیو و دسترس‌پذیری
- **طراحی Mobile-first با Grid/Tailwind Breakpoints**؛ در موبایل استک عمودی یا تب‌های پایین، در دسکتاپ چیدمان چندستونه.
- **جداول و نمودار واکنش‌گرا**: کارت‌سازی ردیف‌ها در موبایل یا اسکرول لمسی افقی؛ ساده‌سازی نمودار در عرض کم.
- **سازگاری تجربه میان دستگاه‌ها**: همگام‌سازی تنظیمات چیدمان/تم در حساب کاربر برای مرورگرهای مختلف.
- **دسترس‌پذیری**: کنتراست مطابق WCAG، فوکوس قابل مشاهده، پشتیبانی از کیبورد و Hotkeyهای رایج برای کاربران حرفه‌ای.

### شخصی‌سازی و چیدمان
- **ویجت‌های قابل جابه‌جایی/تغییر اندازه** (drag & drop) با حالت پیش‌فرض بهینه.
- **ذخیره چیدمان‌ها** برای سناریوهای مختلف بازار (سهام، رمزارز، معاملات سریع).

### پایش و تست
- **پروفایلینگ مداوم عملکرد** در محیط واقعی؛ ثبت متریک‌های کلیدی (زمان لود، نرخ فریم چارت، خطاهای WebSocket).
- **تست کاربردپذیری روی دستگاه‌های واقعی** و سناریوهای شبکه مختلف؛ اطمینان از سرعت واکنش، بازخورد آنی و رندر روان داده‌های زنده.

این راهنما پایه‌ای برای ساخت یک فرانت‌اند معاملاتی مدرن، امن و مقیاس‌پذیر فراهم می‌کند و می‌تواند با رشد تیم و نیازمندی‌ها به میکروفرانت‌اند یا Design System کامل گسترش یابد. برای پیاده‌سازی عملی، توکن‌های طراحی در `src/theme/tokens.css` و مسیرهای کاری در `src/*/README.md` مستند شده‌اند؛ مشخصات فاز 2 (وایرفریم Annotated، کیت کامپوننت، A11y/i18n، تست کاربردپذیری) در `PHASE2_DELIVERABLE.md` موجود است.

## فازبندی اجرا و وضعیت فعلی
- فازهای اجرا در `PROJECT_PHASES.md` شرح داده شده‌اند؛ فاز فعال: **فاز 2 (وایرفریم Hi-Fi و کیت کامپوننت)**.
- خروجی‌های فاز 1 (اهداف، فلوهای Annotated، معماری، توکن‌های دو تم) در `PHASE1_FOUNDATION.md` قفل شده و خروجی فاز 2 در `PHASE2_DELIVERABLE.md` مشخص شده است.
- معماری عملی و چیدمان پوشه‌ها در `ARCHITECTURE.md` مستند شده و اسکلت کد در `src/` ایجاد شده است.

## اجرای محلی (React + Vite + TypeScript)
```bash
pnpm install # یا npm install / yarn
pnpm dev     # اجرای لوکال روی http://localhost:5173
pnpm build   # خروجی production
```

### نمای کد فعلی
- ساختار React با مسیرهای `dashboard`, `markets`, `orders`, `portfolio`, `settings` در `src/App.tsx` و `src/pages/` پیاده‌سازی شده است.
- شِل کلی UI شامل هدر با وضعیت اتصال، ناوبری جانبی، و پانوشت در `components/common/*` است.
- ماژول‌های دامنه معاملاتی (نمودار، دفتر سفارشات، تیکت معامله، دیده‌بان) در `components/trading/*` قرار دارند و آماده اتصال به داده‌ی زنده هستند.
- تم دوگانه از طریق `src/theme/tokens.css` و `ThemeToggle` فعال می‌شود؛ RTL و فونت‌های مونو برای اعداد در کل پروژه رعایت شده است.
